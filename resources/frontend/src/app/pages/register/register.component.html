<div class="register-component" data-testid="register-component">
  <h1>Regisztráció</h1>
  @if (registerErrorMessage()) {
    @switch (registerErrorMessage()) {
      @case ("USER_EXISTS") {
        <app-register-already-exists></app-register-already-exists>
      }
      @case ("USER_NOT_CONFIRMED") {
        <app-register-exists-not-confirmed
          email="{{ email?.value }}"
          (resendConfirmationEmail)="onResendConfirmationEmail()"
        ></app-register-exists-not-confirmed>
      }
      @default {
        <app-form-unexpected-error></app-form-unexpected-error>
      }
    }
  } @else if (registeredEmail()) {
    <app-register-success
      registeredEmail="{{ registeredEmail() }}"
    ></app-register-success>
  }
  @if (resendConfirmationEmailErrorMessage()) {
    <app-register-resend-email-error></app-register-resend-email-error>
  } @else if (resentEmail()) {
    <app-register-resend-email-success
      resentEmail="{{ resentEmail() }}}"
    ></app-register-resend-email-success>
  }
  <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
    <div class="form-elements-container">
      <mat-form-field data-testid="email">
        <mat-label>Email cím</mat-label>
        <input matInput formControlName="email" />
        @if (email?.hasError("required")) {
          <mat-error>Kötelező mező</mat-error>
        } @else if (email?.hasError("email")) {
          <mat-error>Email cím formátuma nem megfelelő</mat-error>
        }
      </mat-form-field>
      <app-password-repeat
        [formGroupName]="'passwords'"
        [showMessage]="password?.valid"
      />
      <mat-checkbox formControlName="newsletter">
        Szeretnék hírlevelet kapni a fontosabb újdonságokról.
      </mat-checkbox>
      <mat-checkbox formControlName="cookies">
        * Hozzájárulok a bejelentkezési adatokat tartalmazó cookie-k
        tárolásához.
      </mat-checkbox>
      <app-button-loadable
        data-testid="submit-button"
        type="submit"
        [loading]="registerMutation.isPending()"
        [disabled]="!registerForm.valid || !registerForm.dirty"
      >
        Regisztráció
      </app-button-loadable>
    </div>
  </form>
  <div class="form-help">
    <p>A szöveges mezők kitöltése kötelező.</p>
    <p>A hírlevélre feliratkozás opcionális.</p>
    <p>A regisztrációhoz kötelező a cookie-k használatának elfogadása.</p>
  </div>
  <div class="form-data-privacy-consent">
    <p>
      A Regisztráció gombra kattintva az adatvédelmi tájékoztatóban foglaltakat
      elfogadom.
    </p>
  </div>
</div>
